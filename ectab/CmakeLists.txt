cmake_minimum_required(VERSION 3.18)

project(ectab)

# set(CMAKE_CXX_STANDARD 11)
# set(CMAKE_CXX_STANDARD_REQUIRED ON)

set(ROOT_DIR "${CMAKE_SOURCE_DIR}")
set(SRC_DIR "${CMAKE_SOURCE_DIR}/src")
# set(THIRDPARTY_DIR "${ROOT_DIR}/thirdparty")

if(WIN32 AND MSVC)
  add_compile_options(-Zc:wchar_t -Zc:forScope -D_ANSI)
  set(CMAKE_MSVC_RUNTIME_LIBRARY "MultiThreaded$<$<CONFIG:Debug>:Debug>")
  set(ADD_SRCS "${SRC_DIR}/win/ActiveCodePageUTF8.manifest")
  set_property(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} PROPERTY VS_STARTUP_PROJECT ${PROJECT_NAME})

  if(CMAKE_CXX_COMPILER_VERSION VERSION_GREATER_EQUAL "19.0.24215.1")
    add_compile_options(-utf-8 -Zc:rvalueCast)
  endif()
  if(CMAKE_CXX_COMPILER_VERSION VERSION_GREATER_EQUAL "19.14.26428.1")
    add_compile_options(-Zc:__cplusplus)
  endif()
  #if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS "19.0")
  #  if(NOT EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/thirdparty/ccwrap")
  #    message(FATAL_ERROR "thirdparty/ccwrap directory is missing. For vc12 and earlier, run thirdparty/install_ccwap.bat")
  #  endif()
  #  set(ADD_INC_DIRS "${CMAKE_CURRENT_SOURCE_DIR}/thirdparty/ccwrap/vc/" "${CMAKE_CURRENT_SOURCE_DIR}/thirdparty/ccwrap/ccwrap/")
  #  add_compile_options(-FIccwrap_header.h)
  #endif()
else()
  if(APPLE)
  else()
    add_compile_options(-finput-charset=utf-8 -fexec-charset=utf-8 -fwide-exec-charset=utf-32LE)
  endif()
endif()

set(SRCS
  ${SRC_DIR}/ectab.c
  ${SRC_DIR}/strtab.c
  ${SRC_DIR}/cmisc.h
  ${SRC_DIR}/ExArgv.c
  ${SRC_DIR}/ExArgv.h
)

add_executable(${PROJECT_NAME}
  ${SRCS}
  ${ADD_SRCS}
)

target_include_directories(${PROJECT_NAME} PRIVATE
  ${ADD_INC_DIRS}
  ${CMAKE_CURRENT_SOURCE_DIR}
)

target_link_libraries(${PROJECT_NAME} PRIVATE
)
