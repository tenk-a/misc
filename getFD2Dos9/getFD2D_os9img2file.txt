getFD2D & os9img2file


■ 概要

  getFD2D.exe は フロッピーディスクからベタなFDイメージファイルを作る
  MSDOS(16ビット) コマンドラインツール。

  os9img2file は getFD2D.exe で作られたos9 FDイメージからファイルを抜き
  出す win32 コマンドラインツール。


  改造元は Mu氏作のDOS環境用の getos9 (をGigo氏がPC-AT向けに移植した版)
a  というフリーソフトなんですが、dos時代のコンバータなため 今となっては
  不要な 8.3 形式のファイル名への変換があり(os9のファイル名は29バイト)、
  また己のWinXP64環境では動かないので、めんどくさいFDDアクセスはDOSアプリ
  として、ロングファイル名で抜き出したいコンバート部はWin32アプリとして、
  分離し好みに改造したのがこのセットです。



■ getFD2D

  usage> getFD2D [-opts] drv: file.img
	 drv:        a: or b:
	 -2d         80*16*256  bytes
	 -2d1        82*16*256  bytes
	 -2dd       160*16*256  bytes
	 -2hd       154*26*256  bytes
	 -2hd1024   154* 8*1024 bytes
	 -cN        シリンダー数(1..85)
	 -snN       シリンダーあたりのセクタ数(1..26)
	 -ssN       セクタサイズ(256,512,1024)
	 -rN        リトライ数(1..16)
	 -reset     biosのセクタサイズを512バイトに強制修正

  a: か b: ドライブにあるフロッピーディスクの内容を、ヘッダ情報もなく
  単純に先頭から詰めて file.img に吐き出します。
  また、読み込みエラーのあったセクタがどれかを記録した file.imh
  というファイルを一緒に生成します。

　デフォルトは 2Dディスク用(-2d1 己のディスク向けなんで^^;) で、
　ディスクに合わせてオプションを指定してください。
  もっとも、-2dd とか -2hd とかありますが、実際のfdを持っていないので
  実際にどうなるかは、わかりません。

　-reset は、吸出し途中で^Cとかで止めちゃったときのおまじない用。
　※もっとも自分は、抜き出し専用にDOS立ち上げて、終わったら電源
　　落としてるので、これを実使用してません...

  borland-c (4.5) でコンパイルしています。
  PC(AT)の DOS専用で、WinのDOS窓では正常動作しません。



■ os9img2file

　　Usage> getos9file command [option] diskimage
　　  command: tree | get
　　  option:  -o#     論理セクターのオフセット
　　           -k[-]   漢字RBF ディスク対策 -k- off
　　           -r#     強制的にrootセクタをNに設定
　　           -dDIR   出力ディレクトリ
　　           -eIMH   エラーセクタ情報ファイル(.imh)の読込

　getFD2D で生成されたディスクイメージファイルから、os9のファイルを
　抜き出すツールです。
　　tree でファイルのツリー一覧表示、get で、ファイルの一括生成です。
　-e で、getFD2D が生成したリードエラー情報ファイルを指定すると、
　get でコンバートするときに、読み込みエラーがあったかどうかが
　表示されるようになります。

  Visual-C(7.1) でコンパイルしています。
  もっとも、こちらは単にファイルの読み書きだけのツールなので、
  bcc32やMinGW でのコンパイル可能、linux 環境でもokでしょう。
　( 玄箱のdebian/linux(sarge) 環境にて動作確認 )。



■ 今更なきっかけ

2006年1月某日、2chの某スレのリンクで某エミュレータがあるのを知り
動いた勇姿にいたく感動、ってのが発端で:-)

早速、押入れより 5寸 2D FD を引っ張りだし、5寸ドライブは仕方ない
のでネット通販でAT機につながる PC98 5寸FDDを購入、で、オールド
パソコン(PC88,PC98,FM7 etc)関係を検索してDISKのイメージファイル化
ツールをいくつかダウンロードして試し.... で適当なものがなかったの
で、ありあわせででっち上げた、って代物。

※ あまりに古いディスクなんで(ノーブランドも多いせいもあって^^;)、
   エラー率が高く、へたにプロテクト対策ありな読み込みツールだと
   かえってメタメタな結果になるのだった...



■ こまごま

　元のmu氏作のgetOS9を発掘できなかったこともあって、版権等不明...
まあ、かって改造物です。

os9 2d 以外については、やりかけ放置なので、いろいろ不味い部分も
あるだろうけど、とりあえず。


                                Masashi KITAMURA (tenka@6809.net)
