csstob v1.01  −− Ｃソース中の // コメントを /* コメント */ に変換 −−


□ はじめに

    Cソース中の // コメントを /* コメント */ に置換するツールです。最近
  の Cコンパイラは // を受け付けますが、古いコンパイラやC99以前の文法に
  忠実なCコンパイラでコンパイルするために用意しました。
  （移植作業しててターゲット用のＣコンパイラが // を受け付けてくれないの
    でデッチあげたプログラム... エディタのキーマクロでその場しのぎで書
    きかえてたのですが馬鹿らしくなって作った代物）。

      ただし完璧なツールというわけではなく、基本的にコンパイルの通るソース
    前提ですし、#if 〜 #endifの中身は条件式の結果に関わらずすべて処理対象
    ですので、動作や対象とするソースの状態をよく確認した上で変換作業は行
    なってください。



□ 使い方

    usage> csstob [-opts] srcfile newfile

    opts:

      -x[EXT]  指定ファイルは一つで新しいファイルを元の名で出力
               し、元ファイルは拡張子を .EXT にする.
               EXT省略時は .bak にする.

      -j       指定ファイル名や入力したテキストに関してMS全角(SJIS)文字
               を考慮する（デフォルト動作）

      -j-      MS全角(SJIS)を考慮しない

      -y[FILE] エラーメッセージを FILE に出力する。
               -y のみだと標準出力する。
               -y がなければエラーメッセージは標準エラー出力される。

      -        何もしないオプション。
               入力ファイルを指定せず標準入力したい場合に - を
               指定してください。
               (このプログラムは引数がない場合、ヘルプ表示になるため）



□ 動作

    Ｃソースを読込み、// コメントを /* コメント */ に置き換えます。
  とりあえず、以下のようになります。

  1)    変換前: int tstflag;            // テストを 1:する 0:しない
        変換後: int tstflag;            /* テストを 1:する 0:しない */

  2)    変換前: ="// とか /* ";         // コメント //
        変換後: ="// とか /* ";         /* コメント // */

  3)    変換前: {L'表','"','\'',"\"\\"},   // 全角や \ " ' は一応対処
        変換後: {L'表','"','\'',"\"\\"},   /* 全角や \ " ' は一応対処 */

  4)    変換前: ///////// サブルーチン //////////
        変換後: /* ////// サブルーチン ////////// */

  5)    変換前: // /*危ない?...*/ 大丈夫か '/*'は
        変換後: /* / *危ない?...* / 大丈夫か '/ *'は */

    基本的に入力行中に // があれば /* に置き換え行末に */ を付加している
    だけです。

    上記 2), 3) のように 一応 " ' \ やMS全角にはある程度対処してあります。
  " や ' の囲みでは途中に改行が現れても大丈夫です。 というか閉じるまでは
  コメント変換処理をしません。
    MS全角(シフトJIS)に関しては -j[-] オプションで、チェックの有無を切り
  替えられます。デフォルトでは、全角チェックを行います。

    4)のように /// が 3つ以上続いている場合、 /*/ となるとコンパイラに文
  句言われる場合もあるので 3つ目の / は空白に置き代えています。

    5)のように // コメント中に /* や */ があると / * とか * / のように、
  間に空白' 'を挿入します.



□ 注意点

      単純な作りなので基本的に入力するソースはコンパイルできるもののみに
    してください。/* */ のネストは不可です（今時しないけど）。
      また、#if 〜 #endif などで条件不成立にしてコメントを書いている場合
    も不都合が発生する可能性があります。

        例）#if 0 /* COMMENT */
                コンパイル時はコメントして機能するが、このツールでは
                この部分も処理しちゃうので、 //があったり、
                " や ' が奇数個あったり */ や /* が閉じてなかったりする
                と、誤変換しちゃうでせう
            #endif

    上記のようなことをせず、つまり #if 〜 #endif の中身は 文法的に C の
    ソースで、コメントは/*〜*/や //〜 に必ずなるように記述されたソースで
    あれば問題ないはずです。



■  ライセンス等

    二条項BSDライセンスです。

    再コンパイルですが、 ANSI系,unix系のライブラリ関数以外で使ってるのは
  stricmpだけなので、MS-Cを意識した(MS-DOS用ANSI)Ｃコンパイラならば,ほぼ
  そのまま再コンパイルできると思われます（v1.0において BC3,LsiC86(試食),
  WatcomC10.5, BCC v5.5 で確認）


                                       Masashi KITAMURA (tenka@6809.net)
